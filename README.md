# prototype-image-processing-benchmark

## Handler Event Parameters

| NAME | TYPE | DESC |
|---|---|---|
| rows | number | 가로 분할 횟수 |
| cols | number | 세로 분할 횟수 |
| name | string | 이미지 Name  |

## Flow

1. Image fetch from AWS.S3
2. Image Crop(Sharp extract)

## Benchmark

- Crop할 이미지는 S3에 저장된 이미지를 Fetch 하였습니다.
- Image fetch time은 process.hrtiome()을 이용하여 체크하였습니다.
- 이미지를 rows는 10으로 고정, cols 를 [10, 20, 30, 40, 50] 으로 변경하여 Crop하여 보았습니다.
- Lambda hot, cold 상태를 고려하여 케이스별 테스트는 8회를 실행하였고 후자 5회를 기록하였습니다.
- Time 의 단위는 ms 입니다.
- [Chart (Billed)](https://jsfiddle.net/alanwake/bd9fk50c/23/)

1. 이미지 1 ( Size : 10000 x 10000, 1.2MB, JPEG )

    1. 100 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 146.16 | 14056.31 | 14100 | 1918 |
    |  2  | 54.19 | 13872.85 | 13900 | 1918 |
    |  3  | 76.92 | 13847.04 | 13900 | 1918 |
    |  4  | 51.91 | 13856.43 | 13900 | 1918 |
    |  5  | 74.77 | 13974.24 | 14000 | 1950 |
    | Avg | 80.79 | 13921.37 | 14000(13960) | 1924 |


    2. 200 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 55.37  | 27680.62 | 27700 | 1902 |
    |  2  | 106.23 | 27244.72 | 27300 | 1921 |
    |  3  | 57.91  | 27519.76 | 27600 | 1921 |
    |  4  | 83.44  | 27263.39 | 27300 | 1921 |
    |  5  | 115.12 | 27558.78 | 27600 | 1921 |
    | Avg | 83.61 | 27453.45 | 27500 | 1917.2 |

    3. 300 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 106.08 | 40441.88 | 40500 | 1902 |
    |  2  | 162.84 | 40216.44 | 40300 | 1921 |
    |  3  | 57.19  | 40550.51 | 40600 | 1937 |
    |  4  | 124.95 | 40512.45 | 40600 | 1937 |
    |  5  | 90.11  | 40491.92 | 40500 | 1937 |
    | Avg | 108.23 | 40442.64 | 40500 | 1906.8 |

    4. 400 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 54.03 | 53741.44 | 53800 | 1902 |
    |  2  | 77.50 | 53851.00 | 53900 | 1937 |
    |  3  | 94.51 | 53743.73 | 53800 | 1937 |
    |  4  | 82.39 | 53872.17 | 53900 | 1950 |
    |  5  | 66.25 | 53954.02 | 54000 | 1950 |
    | Avg | 74.93 | 53832.47 | 53900(53880) | 1935.2 |

    5. 500 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 77.57  | 67113.44 | 67200 | 1918 |
    |  2  | 123.42 | 66809.89 | 66900 | 1950 |
    |  3  | 75.97  | 66958.42 | 67000 | 1950 |
    |  4  | 115.27 | 67427.81 | 67500 | 1950 |
    |  5  | 78.54  | 67370.64 | 67400 | 1950 |
    | Avg | 94.15  | 67136.04 | 67200 | 1943.6 |

2. 이미지 2 ( Size : 15360 × 8640, 12.5MB, JPEG )

    1. 100 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 182.50 | 20894.22 | 20900 | 2461 |
    |  2  | 178.47 | 21324.37 | 21400 | 2320 |
    |  3  | 171.74 | 22156.09 | 22200 | 2320 |
    |  4  | 234.35 | 21948.83 | 22000 | 2185 |
    |  5  | 197.26 | 21690.33 | 21700 | 2185 |
    | Avg | 192.86 | 21602.76 | 21700(21640) | 2294.2 |

    2. 200 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 139.30 | 39433.80 | 39500 | 2535 |
    |  2  | 155.07 | 39319.39 | 39400 | 2527 |
    |  3  | 160.57 | 39524.64 | 39600 | 2475 |
    |  4  | 181.79 | 39325.25 | 39400 | 2475 |
    |  5  | 179.04 | 39914.74 | 40000 | 2461 |
    | Avg | 163.15 | 39503.56 | 39600(39580) | 2494.6 |

    3. 300 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 173.40 | 58963.09 | 59000 | 2629 |
    |  2  | 185.53 | 58387.89 | 58400 | 2629 |
    |  3  | 150.40 | 58677.18 | 58700 | 2629 |
    |  4  | 176.02 | 57964.05 | 58000 | 2610 |
    |  5  | 181.91 | 58191.09 | 58200 | 2576 |
    | Avg | 173.45 | 58436.66 | 58500(58460) | 2614.6 |

    4. 400 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 257.41 | 75015.37 | 75100 | 2981 |
    |  2  | 256.84 | 75651.40 | 75700 | 2981 |
    |  3  | 285.71 | 75559.05 | 75600 | 2633 |
    |  4  | 200.59 | 75046.54 | 75100 | 2620 | 
    |  5  | 296.35 | 75213.71 | 75300 | 2525 |
    | Avg | 259.38 | 75297.21 | 75400(75360) | 2748 |

    5. 500 장

    |     | Image fetch time | Duration Time | Billed Time | Max Memory Used(Mb) |
    |:---:|-----------------:|--------------:|------------:|--------------------:|
    |  1  | 229.88 | 92845.89 | 92900 | 2569 |
    |  2  | 272.61 | 92676.73 | 92700 | 2981 |
    |  3  | 249.68 | 93266.92 | 93300 | 2981 |
    |  4  | 274.83 | 93375.31 | 93400 | 2981 |
    |  5  | 258.99 | 93319.87 | 93400 | 2981 |
    | Avg | 257.19 | 93096.94 | 93200(93140) | 2898.6 |

